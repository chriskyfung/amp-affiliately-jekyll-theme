{%- if include.playlist -%}
  {%- assign video_url = 'https://www.youtube.com/watch?v=' | append: include.id | append: '&list=' | append: include.playlist -%}
  {%- assign attrs_for_playlist = ' data-param-listType="playlist" data-param-list="' | append: include.playlist | append: '"' -%}
{%- else -%}
  {%- assign video_url = 'https://www.youtube.com/watch?v=' | append: include.id -%}
{%- endif -%}

{%- if include.title -%}
  {%- assign attr_title = ' title="' | append: include.title | append: '"' -%}
  {%- capture video_label -%}{{ include.title | escape_once }}{%- endcapture -%}
  {%- else -%}
  {%- assign attr_title = '' -%}
  {%- capture video_label -%}youtu.be/{{ include.id }}{%- endcapture -%}
{%- endif -%}

{{ include.indent }}<amp-youtube width="480" height="270" layout="responsive" data-videoid="{{- include.id -}}"{{ attrs_for_playlist }}{{attr_title}} data-param-rel="0">
  <div fallback>
    <p>This browser does not support the YouTube video player. <a href="{{- video_url -}}" rel="noopener" target="_blank">Watch on YouTube</a></p>
  </div>
{{ include.indent }}</amp-youtube>
