name: Build and Deploy to Github Pages

on:
  push:
    branches: [ master ]
    
jobs:
  jekyll:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Setup package.json
      run: npm install

    # Use GitHub Actions' cache to shorten build times and decrease load on servers
    - uses: actions/cache@v2
      with:
        path: vendor/bundle
        key: ${{ runner.os }}-gems-${{ hashFiles('**/Gemfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-gems-
    
    # Standard usage
    - uses:  helaili/jekyll-action@v2
      with:
        #token: ${{ secrets.GH_PAGES_TOKEN }}
        #target_branch: 'gh-pages'
        jekyll_src: './'
        target_path: './build'
        build_only: true

    - name: Optimize AMP
      run: npx gulp

    - name: Deploy ðŸš€
      uses: JamesIves/github-pages-deploy-action@4.1.5
      with:
        branch: gh-pages
        folder: 'build'